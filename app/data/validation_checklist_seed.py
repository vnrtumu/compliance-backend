"""
Seed data for validation_checklist table

This script populates the validation checklist with 58 compliance checks
derived from GST/TDS regulations and company policy.
"""

VALIDATION_CHECKS = [
    # ============================================
    # DOCUMENT AUTHENTICITY (15 points total)
    # ============================================
    {
        "check_code": "DOC-001",
        "check_name": "Invoice Date Validity",
        "category": "DOCUMENT",
        "subcategory": "DATE",
        "description": "Invoice date is not in the future and within acceptable age limit",
        "validation_logic": "invoice_date <= today AND invoice_date >= today - 180 days",
        "error_message": "Invoice date is in the future or older than 180 days",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 2.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "Company Policy - Invoice Acceptance Rules"
    },
    {
        "check_code": "DOC-002",
        "check_name": "Invoice Number Format",
        "category": "DOCUMENT",
        "subcategory": "FORMAT",
        "description": "Invoice number follows valid format and is not empty",
        "validation_logic": "invoice_number IS NOT NULL AND length > 0",
        "error_message": "Missing or invalid invoice number",
        "complexity": "LOW",
        "complexity_score": 1,
        "weight": 2.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "GST Invoice Rules"
    },
    {
        "check_code": "DOC-003",
        "check_name": "Duplicate Invoice Detection",
        "category": "DOCUMENT",
        "subcategory": "DUPLICATE",
        "description": "Check if same invoice number + vendor + amount exists in last 365 days",
        "validation_logic": "No matching record in uploads with same vendor_gstin, invoice_number, amount",
        "error_message": "Duplicate invoice detected",
        "complexity": "MEDIUM",
        "complexity_score": 4,
        "weight": 3.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "Company Policy - Duplicate Detection"
    },
    {
        "check_code": "DOC-004",
        "check_name": "Self-Invoice Check",
        "category": "DOCUMENT",
        "subcategory": "VALIDITY",
        "description": "Seller GSTIN should not be company's own GSTIN",
        "validation_logic": "seller_gstin != company_gstin (27AABCF9999K1ZX)",
        "error_message": "Self-invoice not valid for accounts payable",
        "complexity": "LOW",
        "complexity_score": 1,
        "weight": 2.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "GST Rules"
    },
    {
        "check_code": "DOC-005",
        "check_name": "Invoice Amount Positive",
        "category": "DOCUMENT",
        "subcategory": "AMOUNT",
        "description": "Invoice total amount must be greater than zero",
        "validation_logic": "total_amount > 0",
        "error_message": "Invoice amount must be positive",
        "complexity": "LOW",
        "complexity_score": 1,
        "weight": 2.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "GST Invoice Rules"
    },
    {
        "check_code": "DOC-006",
        "check_name": "Required Fields Present",
        "category": "DOCUMENT",
        "subcategory": "COMPLETENESS",
        "description": "All mandatory invoice fields are present",
        "validation_logic": "seller_gstin, invoice_number, date, amount are not null",
        "error_message": "Missing mandatory fields",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 2.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "GST Invoice Rules Rule 46"
    },
    {
        "check_code": "DOC-007",
        "check_name": "FY Cutoff Compliance",
        "category": "DOCUMENT",
        "subcategory": "DATE",
        "description": "March invoices accepted until April 15, proper FY allocation",
        "validation_logic": "If invoice_month = March and current_month = April, accept until 15th",
        "error_message": "Invoice date outside acceptable FY cutoff period",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "requires_manual_review": False,
        "reference_document": "Company Policy - FY Cutoff Rules"
    },
    
    # ============================================
    # GST COMPLIANCE (25 points total)
    # ============================================
    {
        "check_code": "GST-001",
        "check_name": "GSTIN Format Validation",
        "category": "GST",
        "subcategory": "GSTIN",
        "description": "Verify GSTIN is 15 characters alphanumeric with valid checksum",
        "validation_logic": "regex(^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[A-Z0-9]{1}Z[A-Z0-9]{1}$)",
        "error_message": "Invalid GSTIN format",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 3.0,
        "is_automated": True,
        "auto_reject": True,
        "reference_document": "GST Act Section 2(45)"
    },
    {
        "check_code": "GST-002",
        "check_name": "GSTIN Active Status",
        "category": "GST",
        "subcategory": "GSTIN",
        "description": "Verify GSTIN is active (not suspended/cancelled) on invoice date",
        "validation_logic": "API call to validate-gstin, status must be ACTIVE",
        "error_message": "GSTIN is suspended or cancelled",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 5.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/validate-gstin",
        "auto_reject": True,
        "reference_document": "Company Policy - GSTIN Validation"
    },
    {
        "check_code": "GST-003",
        "check_name": "State Code Match",
        "category": "GST",
        "subcategory": "GSTIN",
        "description": "First 2 digits of GSTIN should match state code in address",
        "validation_logic": "gstin[0:2] == state_code",
        "error_message": "GSTIN state code does not match address",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "GST Rules"
    },
    {
        "check_code": "GST-004",
        "check_name": "HSN/SAC Code Validity",
        "category": "GST",
        "subcategory": "HSN",
        "description": "Verify HSN/SAC codes exist and are valid for the items",
        "validation_logic": "API call to hsn-rate endpoint",
        "error_message": "Invalid or missing HSN/SAC code",
        "complexity": "MEDIUM",
        "complexity_score": 4,
        "weight": 3.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/hsn-rate",
        "reference_document": "GST HSN Classification"
    },
    {
        "check_code": "GST-005",
        "check_name": "GST Rate Correctness",
        "category": "GST",
        "subcategory": "RATE",
        "description": "Applied GST rate matches the applicable rate for HSN/SAC on invoice date",
        "validation_logic": "Compare invoice rate with API returned rate for date",
        "error_message": "GST rate mismatch - check historical rate changes",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 4.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/hsn-rate",
        "reference_document": "GST Rate Schedule"
    },
    {
        "check_code": "GST-006",
        "check_name": "CGST/SGST vs IGST Logic",
        "category": "GST",
        "subcategory": "TAX_TYPE",
        "description": "Intra-state should have CGST+SGST, inter-state should have IGST",
        "validation_logic": "If seller_state == buyer_state: CGST+SGST; else: IGST",
        "error_message": "Incorrect tax type for transaction type",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "GST Act Section 7,8"
    },
    {
        "check_code": "GST-007",
        "check_name": "Tax Amount Calculation",
        "category": "GST",
        "subcategory": "ARITHMETIC",
        "description": "Verify tax amounts calculated correctly (base * rate)",
        "validation_logic": "abs(calculated_tax - invoice_tax) < tolerance",
        "error_message": "Tax calculation error",
        "complexity": "LOW",
        "complexity_score": 3,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "GST Invoice Rules"
    },
    {
        "check_code": "GST-008",
        "check_name": "E-Invoice Requirement",
        "category": "GST",
        "subcategory": "IRN",
        "description": "Check if e-invoice (IRN) is mandatory based on seller turnover",
        "validation_logic": "API call to e-invoice-required endpoint",
        "error_message": "E-invoice required but not present",
        "complexity": "HIGH",
        "complexity_score": 6,
        "weight": 3.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/e-invoice-required",
        "reference_document": "E-Invoice Mandate Notification"
    },
    {
        "check_code": "GST-009",
        "check_name": "IRN Validity",
        "category": "GST",
        "subcategory": "IRN",
        "description": "Validate IRN is active and matches invoice details",
        "validation_logic": "API call to validate-irn endpoint",
        "error_message": "IRN invalid, cancelled, or mismatched",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 4.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/validate-irn",
        "auto_reject": True,
        "reference_document": "E-Invoice System"
    },
    {
        "check_code": "GST-010",
        "check_name": "Composition Dealer Check",
        "category": "GST",
        "subcategory": "VENDOR_TYPE",
        "description": "Composition dealers cannot charge GST - reject if GST charged",
        "validation_logic": "If taxpayer_type = Composition, gst_amount should be 0",
        "error_message": "Composition dealer incorrectly charging GST",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 3.0,
        "is_automated": True,
        "requires_api_call": True,
        "auto_reject": True,
        "reference_document": "GST Composition Scheme Rules"
    },
    {
        "check_code": "GST-011",
        "check_name": "RCM Applicability",
        "category": "GST",
        "subcategory": "RCM",
        "description": "Check if Reverse Charge Mechanism applies (GTA, imports, etc.)",
        "validation_logic": "Check service type and vendor type for RCM conditions",
        "error_message": "RCM applicable but not handled",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 3.0,
        "is_automated": False,
        "requires_manual_review": True,
        "reference_document": "GST RCM Notification"
    },
    {
        "check_code": "GST-012",
        "check_name": "Item-wise GST Validation",
        "category": "GST",
        "subcategory": "LINE_ITEMS",
        "description": "For mixed supplies, validate GST rate for each line item separately",
        "validation_logic": "Each line item rate matches HSN-specific rate",
        "error_message": "Mixed supplies require item-wise GST validation",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "GST Mixed Supply Rules"
    },
    
    # ============================================
    # TDS COMPLIANCE (20 points total)
    # ============================================
    {
        "check_code": "TDS-001",
        "check_name": "TDS Applicability Check",
        "category": "TDS",
        "subcategory": "APPLICABILITY",
        "description": "Determine if TDS is applicable based on payment type and threshold",
        "validation_logic": "Check service type, amount threshold per section",
        "error_message": "TDS applicability not correctly determined",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 4.0,
        "is_automated": True,
        "reference_document": "Income Tax Act TDS Sections"
    },
    {
        "check_code": "TDS-002",
        "check_name": "194C - Contractor TDS Rate",
        "category": "TDS",
        "subcategory": "194C",
        "description": "Contractor payments - 1% individual/HUF, 2% others",
        "validation_logic": "If contractor service: apply correct rate by vendor type",
        "error_message": "Incorrect 194C TDS rate applied",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Section 194C"
    },
    {
        "check_code": "TDS-003",
        "check_name": "194J - Professional/Technical",
        "category": "TDS",
        "subcategory": "194J",
        "description": "Professional 10%, Technical/Call Center 2%",
        "validation_logic": "Classify service as professional or technical, apply rate",
        "error_message": "Incorrect 194J classification or rate",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 4.0,
        "is_automated": False,
        "requires_manual_review": True,
        "reference_document": "Section 194J"
    },
    {
        "check_code": "TDS-004",
        "check_name": "194I - Rent TDS",
        "category": "TDS",
        "subcategory": "194I",
        "description": "Rent on plant/machinery 2%, Land/building/furniture 10%",
        "validation_logic": "Determine rent type and apply correct rate",
        "error_message": "Incorrect rent TDS rate",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Section 194I"
    },
    {
        "check_code": "TDS-005",
        "check_name": "TDS on GST for Rent",
        "category": "TDS",
        "subcategory": "194I",
        "description": "For rent, TDS should be on gross amount including GST",
        "validation_logic": "tds_base = invoice_amount (including GST)",
        "error_message": "TDS for rent should include GST component",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "CBDT Circular"
    },
    {
        "check_code": "TDS-006",
        "check_name": "206AB Non-Filer Check",
        "category": "TDS",
        "subcategory": "206AB",
        "description": "Higher TDS rate for non-filers under section 206AB",
        "validation_logic": "API call to verify-206ab endpoint",
        "error_message": "Vendor is 206AB non-filer - apply higher TDS rate",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 4.0,
        "is_automated": True,
        "requires_api_call": True,
        "api_endpoint": "/api/gst/verify-206ab",
        "reference_document": "Section 206AB"
    },
    {
        "check_code": "TDS-007",
        "check_name": "Lower Deduction Certificate",
        "category": "TDS",
        "subcategory": "LDC",
        "description": "Check if vendor has valid LDC and apply reduced rate",
        "validation_logic": "Check vendor LDC registry, validate expiry date",
        "error_message": "LDC available but not applied",
        "complexity": "MEDIUM",
        "complexity_score": 6,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "Section 197"
    },
    {
        "check_code": "TDS-008",
        "check_name": "194Q - Goods Purchase TDS",
        "category": "TDS",
        "subcategory": "194Q",
        "description": "0.1% TDS on goods if purchases > 50L in FY",
        "validation_logic": "Track cumulative purchases per vendor, apply after threshold",
        "error_message": "194Q threshold crossed - TDS applicable",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Section 194Q"
    },
    {
        "check_code": "TDS-009",
        "check_name": "Threshold Limit Check",
        "category": "TDS",
        "subcategory": "THRESHOLD",
        "description": "Check section-wise thresholds (30K for 194J, etc.)",
        "validation_logic": "Compare amount against section threshold",
        "error_message": "Below threshold - no TDS required",
        "complexity": "MEDIUM",
        "complexity_score": 4,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "TDS Threshold Limits"
    },
    {
        "check_code": "TDS-010",
        "check_name": "PAN Verification",
        "category": "TDS",
        "subcategory": "PAN",
        "description": "Verify PAN is valid and name matches",
        "validation_logic": "Check PAN format and verify against vendor name",
        "error_message": "PAN invalid or name mismatch",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "TDS Rules"
    },
    
    # ============================================
    # ARITHMETIC ACCURACY (15 points total)
    # ============================================
    {
        "check_code": "ARITH-001",
        "check_name": "Line Item Total",
        "category": "ARITHMETIC",
        "subcategory": "CALCULATION",
        "description": "Sum of line items equals subtotal before tax",
        "validation_logic": "sum(line_items) == subtotal",
        "error_message": "Line items don't add up to subtotal",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Invoice Accuracy"
    },
    {
        "check_code": "ARITH-002",
        "check_name": "Tax Calculation Accuracy",
        "category": "ARITHMETIC",
        "subcategory": "CALCULATION",
        "description": "Tax amounts calculated correctly from base",
        "validation_logic": "abs(base * rate - tax_amount) < 1",
        "error_message": "Tax calculation error",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Invoice Accuracy"
    },
    {
        "check_code": "ARITH-003",
        "check_name": "Grand Total Verification",
        "category": "ARITHMETIC",
        "subcategory": "CALCULATION",
        "description": "Grand total = Subtotal + Taxes - Discounts",
        "validation_logic": "total == subtotal + cgst + sgst + igst - discount",
        "error_message": "Grand total calculation error",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Invoice Accuracy"
    },
    {
        "check_code": "ARITH-004",
        "check_name": "CGST SGST Equality",
        "category": "ARITHMETIC",
        "subcategory": "TAX",
        "description": "For intra-state, CGST should equal SGST",
        "validation_logic": "If intra_state: cgst == sgst",
        "error_message": "CGST and SGST amounts don't match",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "GST Rules"
    },
    {
        "check_code": "ARITH-005",
        "check_name": "Amount Tolerance Check",
        "category": "ARITHMETIC",
        "subcategory": "PO_MATCH",
        "description": "Invoice amount within ±5% or ±₹1000 of PO amount",
        "validation_logic": "abs(invoice - po) < max(po * 0.05, 1000)",
        "error_message": "Invoice amount exceeds PO tolerance",
        "complexity": "MEDIUM",
        "complexity_score": 4,
        "weight": 4.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy"
    },
    
    # ============================================
    # POLICY COMPLIANCE (15 points total)
    # ============================================
    {
        "check_code": "POL-001",
        "check_name": "Approval Level Check",
        "category": "POLICY",
        "subcategory": "APPROVAL",
        "description": "Invoice approved at correct level per amount",
        "validation_logic": "Check approval_matrix against invoice amount",
        "error_message": "Insufficient approval level for amount",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "Company Approval Matrix"
    },
    {
        "check_code": "POL-002",
        "check_name": "First-Time Vendor Extra Checks",
        "category": "POLICY",
        "subcategory": "VENDOR",
        "description": "First invoice from new vendor needs bank verification and Senior Manager approval",
        "validation_logic": "If first_invoice: check bank_verified and approval_level >= 3",
        "error_message": "First-time vendor requires additional verification",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 3.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy - First Time Vendor"
    },
    {
        "check_code": "POL-003",
        "check_name": "Related Party Transaction",
        "category": "POLICY",
        "subcategory": "RELATED_PARTY",
        "description": "Detect same PAN with different GSTIN (related parties)",
        "validation_logic": "Check PAN prefix against known related party list",
        "error_message": "Related party transaction - additional scrutiny required",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 3.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy - Related Party"
    },
    {
        "check_code": "POL-004",
        "check_name": "MSME Payment Terms",
        "category": "POLICY",
        "subcategory": "MSME",
        "description": "MSME vendors must be paid within 45 days",
        "validation_logic": "If vendor_msme: payment_due <= 45 days",
        "error_message": "MSME payment terms violated",
        "complexity": "MEDIUM",
        "complexity_score": 4,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "MSME Act"
    },
    {
        "check_code": "POL-005",
        "check_name": "Budget Availability",
        "category": "POLICY",
        "subcategory": "BUDGET",
        "description": "Check cost center has sufficient budget",
        "validation_logic": "cost_center_budget - consumed >= invoice_amount",
        "error_message": "Insufficient budget in cost center",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Budget Policy"
    },
    {
        "check_code": "POL-006",
        "check_name": "Retrospective Invoice Check",
        "category": "POLICY",
        "subcategory": "DATE",
        "description": "Invoice dated >60 days ago requires Director approval",
        "validation_logic": "If invoice_age > 60: approval_level >= 4",
        "error_message": "Retrospective invoice requires Director approval",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy"
    },
    
    # ============================================
    # DATA QUALITY (10 points total)
    # ============================================
    {
        "check_code": "DQ-001",
        "check_name": "Vendor Name Match",
        "category": "DATA_QUALITY",
        "subcategory": "MATCHING",
        "description": "Vendor name on invoice matches registered name in GST portal",
        "validation_logic": "fuzzy_match(invoice_name, gst_legal_name) > 0.7",
        "error_message": "Vendor name mismatch with GST records",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "reference_document": "Company Policy"
    },
    {
        "check_code": "DQ-002",
        "check_name": "Address Completeness",
        "category": "DATA_QUALITY",
        "subcategory": "COMPLETENESS",
        "description": "Seller and buyer addresses are complete with PIN code",
        "validation_logic": "address IS NOT NULL AND pin_code matches state",
        "error_message": "Incomplete address information",
        "complexity": "LOW",
        "complexity_score": 2,
        "weight": 1.0,
        "is_automated": True,
        "reference_document": "GST Invoice Rules"
    },
    {
        "check_code": "DQ-003",
        "check_name": "Place of Supply",
        "category": "DATA_QUALITY",
        "subcategory": "LOCATION",
        "description": "Place of supply correctly determined for GST type",
        "validation_logic": "pos matches buyer_state for services, delivery_state for goods",
        "error_message": "Place of supply determination error",
        "complexity": "HIGH",
        "complexity_score": 7,
        "weight": 3.0,
        "is_automated": True,
        "reference_document": "GST Rules Section 12,13"
    },
    {
        "check_code": "DQ-004",
        "check_name": "Bank Details Verification",
        "category": "DATA_QUALITY",
        "subcategory": "BANK",
        "description": "Bank account details match vendor records",
        "validation_logic": "bank_account in vendor_approved_accounts",
        "error_message": "Bank account not verified",
        "complexity": "MEDIUM",
        "complexity_score": 5,
        "weight": 2.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy"
    },
    {
        "check_code": "DQ-005",
        "check_name": "Near Duplicate Detection",
        "category": "DATA_QUALITY",
        "subcategory": "DUPLICATE",
        "description": "Flag invoices >95% similar to existing ones",
        "validation_logic": "similarity_score(current, existing) < 0.95",
        "error_message": "Potential near-duplicate invoice detected",
        "complexity": "HIGH",
        "complexity_score": 8,
        "weight": 2.0,
        "is_automated": True,
        "requires_manual_review": True,
        "reference_document": "Company Policy"
    },
]


def get_seed_data():
    """Return the validation checklist seed data."""
    return VALIDATION_CHECKS
